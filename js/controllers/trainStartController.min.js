"use strict";define(["jquery","app"],function(a,b){b.controller("trainStartController",["$scope","$window","$location","webSocketService","applicationService","messageBoxService",function(c,e,h,d,g,f){if(d.webSocket==null){h.url("");return false}if(g.getTrainStatus()){h.url("train_monitor");return false}if(a(".container").parent().height()<g.getMbHeight()){a(".container").parent().css("height","100%")}c.redirectMain=function(){h.url("");return false};g.checkBrowers();e.onunload=function(i){try{g.exit()}catch(i){f.warning(i.message);return false}};c.$on("onMessage",function(k,l){var l=JSON.parse(l);var j=l.code;var i=l.message;switch(j){case"9001":try{f.warning("你已被强制下机.");if(d.webSocket!=null){d.webSocket.close();d.webSocket=null}g.logout(function(o,n){h.url("/");return false})}catch(m){f.warning(m.message);return false}break;case"8003":if(i.power=="1"){f.warning("模拟人断电关机，请检查原因.");if(d.webSocket!=null){d.webSocket.close();d.webSocket=null}g.setTrainStatus(false);g.logout(function(o,n){h.url("/");return false})}break}});c.start=function(){try{g.setTrainStatus(true);if(d.webSocket!=null){d.webSocket.send('{"code":"1002","message":{"project":"0","operation":"1"}}');d.webSocket.send('{"code":"4005","message":{"volume":"9"}}');var i=new delayTask(function(){d.webSocket.send('{"code":"1001","message":{"pupil":"0","pulse":"0"}}')});i.delay(50);var j=new delayTask(function(){d.webSocket.send('{"code":"1003","message":{"depthmin":"'+qcprStand.PRESS_DEEP_LOW+'","depthmax":"'+qcprStand.PRESS_DEEP_HEIGHT+'","breathmin":"'+qcprStand.BREATH_VOLUME_LOW+'","breathmax":"'+qcprStand.BREATH_VOLUME_HEIGHT+'"}}')});j.delay(100)}h.url("train_monitor");return false}catch(k){f.warning(k.message);return false}};c.exit=function(){try{f.confirm("确认退出练习?",function(j){if(j){if(d.webSocket!=null){d.webSocket.close();d.webSocket=null}g.logout(function(l,k){h.url("/");return false})}})}catch(i){f.warning(i.message);return false}};c.$on("$destroy",function(){})}])});