"use strict";define(["jquery","app"],function(a,b){b.controller("mainController",["$scope","$location","$window","$interval","applicationService","messageBoxService","webSocketService","$timeout",function(p,k,f,m,g,n,h,i){var e=f.orientation;if(!e){e=0}if(e==90||e==-90){a(".container").html("");n.alert("横屏下不能获得最佳体验，请竖屏浏览网页.",function(){location.reload()});return false}if(a(".container").parent().height()<g.getMbHeight()){a(".container").parent().css("height","100%")}var j=g.getUser();var d=f.innerWidth;var l=f.innerHeight;localStorage.mbHeight=l;g.setMbWidth(d);g.setMbHeight(l);g.setMbOrientation(e);g.setKickStatus(false);c();p.$on("onOrientation",function(q,r){c()});f.onunload=function(q){try{g.exit()}catch(q){n.warning(q.message);return false}return false};p.exit=function(){n.confirm("确认断开连接?",function(q){if(q){if(h.webSocket!=null){h.webSocket.close();h.webSocket=null}k.url("");if(h.webSocket==null){a("#span_logout").hide()}else{a("#span_logout").show()}}});return false};p.redirectLogin=function(q){p.pageType=q;localStorage.pageType=q;g.setPageType(q);var r="ws://192.168.2.135:7788/";if(h.webSocket==null){h.createWebSocket(r)}return false};var o=m(function(){if(h.webSocket&&h.webSocket.readyState==1){var q=null;if(p.pageType){q=g.getPageType()}else{q=0}switch(q){case 1:k.url("exam_start");break;case 2:k.url("train_start");break;case 3:k.url("cpr_start");break;case 4:k.url("exam_list");break;default:k.url("");break}}},100);p.$on("onOpen",function(q,r){h.webSocket.send('{"code":"1004","message":{"usertype ":"3"}}')});p.$on("onError",function(q,r){});p.$on("onClose",function(q,r){});p.$on("$destroy",function(){if(o){m.cancel(o)}});function c(){a(".main-logo").css({height:l*0.45});a(".main-menu").css({height:(l*0.55-2)/2});a(".img-main-logo").css({width:"100%",height:l*0.55});a(".img-menu").css({width:d/7,height:d/7});a(".w-view-120,.w-view-130,.w-view-140,.w-view-150").css({width:d/4,height:d/4,"line-height":d/4+"px"});a(".w-view-120,.w-view-130,.w-view-140,.w-view-150").css("margin-top",(a(".main-menu").height()-a(".w-view-120").height()-a(".w-view-120").next("div").height())/2+"px");if(h.webSocket==null){a("#span_logout").hide()}else{a("#span_logout").show()}}p.$on("onMessage",function(s,t){var t=JSON.parse(t);var r=t.code;var q=t.message;switch(r){case"9001":try{n.warning("你已被强制下机.");if(h.webSocket!=null){h.webSocket.close();h.webSocket=null}g.logout(function(w,v){k.url("/");a("#span_logout").hide();return false})}catch(u){n.warning(u.message);return false}break;case"8003":if(q.power=="1"){n.warning("模拟人断电关机，请检查原因.");if(h.webSocket!=null){h.webSocket.close();h.webSocket=null}g.setTrainStatus(false);g.logout(function(w,v){k.url("/");a("#span_logout").hide();return false})}break}})}])});