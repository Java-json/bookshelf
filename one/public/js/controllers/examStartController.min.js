"use strict";define(["jquery","app"],function(a,b){b.controller("examStartController",["$window","$scope","$location","webSocketService","applicationService","messageBoxService",function(e,c,h,d,g,f){if(g.getUser()==null){h.url("");return false}if(g.getExamStatus()){h.url("exam_monitor");return false}if(g.hasExam==true){h.url("");f.warning("你已完成考试,不能重复考试.");return false}if(a(".container").parent().height()<g.getMbHeight()){a(".container").parent().css("height","100%")}g.checkBrowers();c.user=g.getUser();c.ip=c.user.robotIp;c.userCnName=c.user.userCnName;c.userAccount=c.user.userAccount;c.robotName=c.user.robotName;c.redirectMain=function(){h.url("");return false};e.onunload=function(i){try{g.exit()}catch(i){f.warning(i.message);return false}};c.$on("onMessage",function(k,l){var l=JSON.parse(l);var j=l.code;var i=l.message;switch(j){case"9001":try{f.warning("你已被强制下机.");if(d.webSocket){d.webSocket.close();d.webSocket=null}g.logout(function(o,n){h.url("/");return false})}catch(m){f.warning(m.message);return false}break;case"8003":if(i.power=="1"){f.warning("模拟人断电关机，请检查原因.");if(d.webSocket!=null){d.webSocket.close();d.webSocket=null}g.setTrainStatus(false);g.logout(function(o,n){h.url("/");return false})}break}});c.start=function(){try{g.setExamStatus(true);if(d.webSocket!=null){d.webSocket.send('{"code":"1002","message":{"project":"1","operation":"1"}}');var i=new delayTask(function(){d.webSocket.send('{"code":"1001","message":{"pupil":"0","pulse":"0"}}')});i.delay(50)}h.url("exam_monitor");return false}catch(j){f.warning(j.message);return false}};c.exit=function(){try{f.confirm("确认退出考试?",function(j){if(j){if(d.webSocket){d.webSocket.close();d.webSocket=null}g.logout(function(l,k){h.url("/");return false})}})}catch(i){f.warning(i.message);return false}}}])});