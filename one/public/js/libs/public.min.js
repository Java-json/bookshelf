var userRobotList=[];var userBeginStatusList=[];var timerList=[];var userTimerList=[];var studentTotalScoreList=[];var pulseDateInfoList=[];var toothAirWayStatusList=[];var studentStepScoreList=[];var pressLoopDataList=[];var pressDataList=[];var breathDataList=[];var stepInfoList=[];var logInfoList=[];var loopStepFlag=true;var qcprStand={EXAM_TIME:0,PULSE_TIME_LOW:0,PULSE_TIME_HEIGHT:0,PRESS_TRUE_RATE_LOW:0,BREATH_TRUE_RATE_LOW:0,PRESS_RATE_LOW:0,PRESS_RATE_HEIGHT:0,PRESS_DEEP_LOW:0,PRESS_DEEP_HEIGHT:0,BREATH_VOLUME_LOW:0,BREATH_VOLUME_HEIGHT:0,PLACE_SCORE:0,PRESS_POSE_SCORE:0,CARE_SCORE:0,CC_SCORE:0,TIME_SCORE:0,SAFE_SCORE:0,KNOW_SCORE:0,PULSE_SCORE:0,HELP_SCORE:0,PRESS_SCORE:0,TOOTH_SCORE:0,AIRWAY_SCORE:0,BREATH_SCORE:0,ASSESS_SCORE:0,SAFE_STEP_SCORE:0,KNOW_STEP_SCORE:0,PULSE_STEP_SCORE:0,HELP_STEP_SCORE:0,PRESS_STEP_SCORE:0,TOOTH_STEP_SCORE:0,AIRWAY_STEP_SCORE:0,BREATH_STEP_SCORE:0,ASSESS_STEP_SCORE:0};var orderStep={SAFE:1,KNOW:2,PULSE:3,HELP:4,PRESS:5,TOOTH:6,AIRWAY:7,BREATH:8,ASSESS:9};function initScoreStandard(scoreStandardList){for(var i in scoreStandardList){var scoreStandard=scoreStandardList[i];var opertionSort=scoreStandard.opertionSort;switch(opertionSort){case 1:qcprStand.SAFE_SCORE=scoreStandard.opertionSkillScore;qcprStand.SAFE_STEP_SCORE=scoreStandard.opertionFlowScore;break;case 2:qcprStand.KNOW_SCORE=scoreStandard.opertionSkillScore;qcprStand.KNOW_STEP_SCORE=scoreStandard.opertionFlowScore;break;case 3:qcprStand.PULSE_SCORE=scoreStandard.opertionSkillScore;qcprStand.PULSE_STEP_SCORE=scoreStandard.opertionFlowScore;var opertionCondition=scoreStandard.opertionCondition.split("|");qcprStand.PULSE_TIME_LOW=opertionCondition[0];qcprStand.PULSE_TIME_HEIGHT=opertionCondition[1];break;case 4:qcprStand.HELP_SCORE=scoreStandard.opertionSkillScore;qcprStand.HELP_STEP_SCORE=scoreStandard.opertionFlowScore;break;case 5:qcprStand.PRESS_SCORE=scoreStandard.opertionSkillScore;qcprStand.PRESS_STEP_SCORE=scoreStandard.opertionFlowScore;var opertionCondition=scoreStandard.opertionCondition.split("|");qcprStand.PRESS_DEEP_LOW=opertionCondition[0];qcprStand.PRESS_DEEP_HEIGHT=opertionCondition[1];qcprStand.PRESS_RATE_LOW=opertionCondition[2];qcprStand.PRESS_RATE_HEIGHT=opertionCondition[3];qcprStand.PRESS_TRUE_RATE_LOW=opertionCondition[4];break;case 6:qcprStand.TOOTH_SCORE=scoreStandard.opertionSkillScore;qcprStand.TOOTH_STEP_SCORE=scoreStandard.opertionFlowScore;break;case 7:qcprStand.AIRWAY_SCORE=scoreStandard.opertionSkillScore;qcprStand.AIRWAY_STEP_SCORE=scoreStandard.opertionFlowScore;break;case 8:qcprStand.BREATH_SCORE=scoreStandard.opertionSkillScore;qcprStand.BREATH_STEP_SCORE=scoreStandard.opertionFlowScore;var opertionCondition=scoreStandard.opertionCondition.split("|");qcprStand.BREATH_VOLUME_LOW=opertionCondition[0];qcprStand.BREATH_VOLUME_HEIGHT=opertionCondition[1];qcprStand.BREATH_TRUE_RATE_LOW=opertionCondition[2];break;case 9:qcprStand.ASSESS_SCORE=scoreStandard.opertionSkillScore;qcprStand.ASSESS_STEP_SCORE=scoreStandard.opertionFlowScore;break;case 10:qcprStand.PLACE_SCORE=scoreStandard.opertionSkillScore;break;case 11:qcprStand.PRESS_POSE_SCORE=scoreStandard.opertionSkillScore;break;case 12:qcprStand.CC_SCORE=scoreStandard.opertionSkillScore;break;case 13:qcprStand.CARE_SCORE=scoreStandard.opertionSkillScore;break;case 14:qcprStand.TIME_SCORE=scoreStandard.opertionSkillScore;var opertionCondition=scoreStandard.opertionCondition;qcprStand.EXAM_TIME=opertionCondition;break;default:break}}}function createData(robotName,flag){if(flag==1){finishTime(robotName);var timer=getTimer(robotName,0);timer();var timeInterval=setInterval(timer,1000);var timeInfo={};timeInfo.robotName=robotName;timeInfo.time=timeInterval;timerList.push(timeInfo);var userTime={};userTime.robotName=robotName;userTime.userTime=0;userTimerList.push(userTime);var userBeginStatus={};userBeginStatus.robotName=robotName;userBeginStatus.beginStatus=1;userBeginStatusList.push(userBeginStatus);var logInfo={};logInfo.robotName=robotName;var LogList=[];logInfo.LogList=LogList;logInfoList.push(logInfo)}var studentTotalScore={};studentTotalScore.robotName=robotName;studentTotalScore.placeScore=qcprStand.PLACE_SCORE;studentTotalScore.pressPoseScore=qcprStand.PRESS_POSE_SCORE;studentTotalScore.careScore=qcprStand.CARE_SCORE;studentTotalScore.ccScore=qcprStand.CC_SCORE;studentTotalScore.timeScore=0;studentTotalScore.safeStepScore=0;studentTotalScore.knowStepScore=0;studentTotalScore.pulseStepScore=0;studentTotalScore.helpStepScore=0;studentTotalScore.pressStepScore=0;studentTotalScore.toothStepScore=0;studentTotalScore.airwayStepScore=0;studentTotalScore.breathStepScore=0;studentTotalScore.assessStepScore=0;studentTotalScore.safeScore=0;studentTotalScore.knowScore=0;studentTotalScore.pulseScore=0;studentTotalScore.helpScore=0;studentTotalScore.pressScore=0;studentTotalScore.toothScore=0;studentTotalScore.airwayScore=0;studentTotalScore.breathScore=0;studentTotalScore.assessScore=0;studentTotalScore.pressBackTrueRate=0;studentTotalScore.pressDeepTrueRate=0;
studentTotalScore.pressSpeedTrueRate=0;studentTotalScore.pressTrueRate=0;studentTotalScore.breathTrueRate=0;studentTotalScoreList.push(studentTotalScore);var pulseDateInfo={};pulseDateInfo.robotName=robotName;pulseDateInfo.pulseDateList=[];var pulseDate={};pulseDate.step=3;pulseDate.beginDate=0;pulseDate.endDate=0;pulseDateInfo.pulseDateList.push(pulseDate);var pulseDate={};pulseDate.step=9;pulseDate.beginDate=0;pulseDate.endDate=0;pulseDateInfo.pulseDateList.push(pulseDate);pulseDateInfoList.push(pulseDateInfo);var toothAirWayStatus={};toothAirWayStatus.robotName=robotName;toothAirWayStatus.toothStatus=1;toothAirWayStatus.airWayStatus=0;toothAirWayStatus.positionStatus=0;toothAirWayStatusList.push(toothAirWayStatus);var studentStepScore={};var stepScoreList=[];studentStepScore.robotName=robotName;studentStepScore.stepScoreList=stepScoreList;studentStepScoreList.push(studentStepScore);var pressLoopData={};pressLoopData.robotName=robotName;pressLoopData.pressLoopNum=0;pressLoopData.pressNum=0;pressLoopData.breathNum=0;pressLoopDataList.push(pressLoopData);var pressData={};pressData.robotName=robotName;pressData.pressBackList=[];pressData.pressDeepList=[];pressData.pressSpeedList=[];pressData.pressPositionList=[];pressDataList.push(pressData);var breathData={};breathData.robotName=robotName;breathData.breathTimeList=[];breathData.breathContentList=[];breathDataList.push(breathData);var stepInfo={};var stepList=[0,0,0,0,0,0,0,0,0];stepInfo.robotName=robotName;stepInfo.stepList=stepList;stepInfoList.push(stepInfo)}function clearStudentData(robotName){_.remove(userRobotList,function(chr){return chr.robotName==robotName});_.remove(userBeginStatusList,function(chr){return chr.robotName==robotName});finishTime(robotName);_.remove(timerList,function(chr){return chr.robotName==robotName});_.remove(userTimerList,function(chr){return chr.robotName==robotName});_.remove(studentTotalScoreList,function(chr){return chr.robotName==robotName});_.remove(pulseDateInfoList,function(chr){return chr.robotName==robotName});_.remove(toothAirWayStatusList,function(chr){return chr.robotName==robotName});_.remove(studentStepScoreList,function(chr){return chr.robotName==robotName});_.remove(pressLoopDataList,function(chr){return chr.robotName==robotName});_.remove(pressDataList,function(chr){return chr.robotName==robotName});_.remove(breathDataList,function(chr){return chr.robotName==robotName});_.remove(stepInfoList,function(chr){return chr.robotName==robotName});_.remove(logInfoList,function(chr){return chr.robotName==robotName})}function changeToothStatus(robotName,tooth){for(var i in toothAirWayStatusList){if(toothAirWayStatusList[i].robotName==robotName){toothAirWayStatusList[i].toothStatus=tooth;break}}}function changeAirwayStatus(robotName,airway){for(var i in toothAirWayStatusList){if(toothAirWayStatusList[i].robotName==robotName){toothAirWayStatusList[i].airWayStatus=airway;break}}}function changePositionStatus(robotName,position){for(var i in toothAirWayStatusList){if(toothAirWayStatusList[i].robotName==robotName){toothAirWayStatusList[i].positionStatus=position;break}}}function getToothStatus(robotName){var toothStatus=0;for(var i in toothAirWayStatusList){if(toothAirWayStatusList[i].robotName==robotName){toothStatus=toothAirWayStatusList[i].toothStatus;break}}return toothStatus}function getAirWayStatus(robotName){var airWayStatus=0;for(var i in toothAirWayStatusList){if(toothAirWayStatusList[i].robotName==robotName){airWayStatus=toothAirWayStatusList[i].airWayStatus;break}}return airWayStatus}function getPositionStatus(robotName){var positionStatus=0;for(var i in toothAirWayStatusList){if(toothAirWayStatusList[i].robotName==robotName){positionStatus=toothAirWayStatusList[i].positionStatus;break}}return positionStatus}function addStudentStep(robotName,step){for(var i in stepInfoList){if(stepInfoList[i].robotName==robotName){stepInfoList[i].stepList[step-1]=1;break}}}function addPulseDate(robotName,step,status){var currentTime=(new Date()).getTime();for(var i in pulseDateInfoList){if(pulseDateInfoList[i].robotName==robotName){if(step==3){var pulseDateInfo=pulseDateInfoList[i].pulseDateList[0];if(status==1){pulseDateInfo.beginDate=currentTime}else{if(status==0){pulseDateInfo.endDate=currentTime}}}else{if(step==9){var pulseDateInfo=pulseDateInfoList[i].pulseDateList[1];if(status==1){pulseDateInfo.beginDate=currentTime}else{if(status==0){pulseDateInfo.endDate=currentTime}}}}break}}}function getPulseTime(robotName,step){var time=0;for(var i in pulseDateInfoList){if(pulseDateInfoList[i].robotName==robotName){if(step==3){var pulseDateInfo=pulseDateInfoList[i].pulseDateList[0];var beginDate=pulseDateInfo.beginDate;var endDate=pulseDateInfo.endDate;time=Math.ceil((endDate-beginDate)/1000)}else{if(step==9){var pulseDateInfo=pulseDateInfoList[i].pulseDateList[1];var beginDate=pulseDateInfo.beginDate;var endDate=pulseDateInfo.endDate;time=Math.ceil((endDate-beginDate)/1000)}}break}}return time}function addStudentPressLoopNum(robotName,freq){if(freq==0){for(var k in pressLoopDataList){if(pressLoopDataList[k].robotName==robotName){pressLoopDataList[k].pressLoopNum+=1;
pressLoopDataList[k].pressNum=0;pressLoopDataList[k].breathNum=0;pressLoopDataList[k].pressNum+=1;break}}}else{if(freq==-2){for(var k in pressLoopDataList){if(pressLoopDataList[k].robotName==robotName){pressLoopDataList[k].breathNum+=1;break}}}else{for(var k in pressLoopDataList){if(pressLoopDataList[k].robotName==robotName){pressLoopDataList[k].pressNum+=1;break}}}}}function checkPressLoopNum(robotName){var pressLoopNum=0;for(var k in pressLoopDataList){if(pressLoopDataList[k].robotName==robotName){pressLoopNum=pressLoopDataList[k].pressLoopNum;break}}return pressLoopNum}function checkPressNum(robotName){var pressNum=0;for(var k in pressLoopDataList){if(pressLoopDataList[k].robotName==robotName){pressNum=pressLoopDataList[k].pressNum;break}}return pressNum}function checkBreathNum(robotName){var breathNum=0;for(var k in pressLoopDataList){if(pressLoopDataList[k].robotName==robotName){breathNum=pressLoopDataList[k].breathNum;break}}return breathNum}function changeBeginStatus(robotName,status){for(var i in userBeginStatusList){if(userBeginStatusList[i].robotName==robotName){userBeginStatusList[i].beginStatus=status;break}}}function getBeginStatus(robotName){var beginStatus=0;for(var i in userBeginStatusList){if(userBeginStatusList[i].robotName==robotName){beginStatus=userBeginStatusList[i].beginStatus;break}}return beginStatus}function addPressData(robotName,pressData){for(var i in pressDataList){if(pressDataList[i].robotName==robotName){pressDataList[i].pressBackList.push(pressData.undelivered==0?1:0);pressDataList[i].pressDeepList.push(pressData.depth>=qcprStand.PRESS_DEEP_LOW&&pressData.depth<=qcprStand.PRESS_DEEP_HEIGHT?1:0);pressDataList[i].pressSpeedList.push(pressData.freq);pressDataList[i].pressPositionList.push(pressData.middle==1?1:0);break}}}function addBreathData(robotName,breathData){for(var i in breathDataList){if(breathDataList[i].robotName==robotName){breathDataList[i].breathTimeList.push(breathData.fast==0?1:0);breathDataList[i].breathContentList.push(breathData.breath>=qcprStand.BREATH_VOLUME_LOW&&breathData.breath<=qcprStand.BREATH_VOLUME_HEIGHT?1:0);break}}}function addStepScore(robotName,step,loopNum,score,actionData){var stepScore={};stepScore.step=step;stepScore.loopNum=loopNum;var stepDataList=[];stepScore.stepDataList=stepDataList;if(step==1||step==2||step==3||step==4||step==6||step==7||step==9){stepScore.stepDataList.push(score);for(var i in studentStepScoreList){if(studentStepScoreList[i].robotName==robotName){studentStepScoreList[i].stepScoreList.push(stepScore);break}}}else{if(step==5){for(var j in studentStepScoreList){if(studentStepScoreList[j].robotName==robotName){var stepScoreList=studentStepScoreList[j].stepScoreList;var flag=false;var index=0;for(var k in stepScoreList){if(stepScoreList[k].step==5&&stepScoreList[k].loopNum==loopNum){index=k;flag=true;break}}if(flag==true){stepScoreList[index].stepDataList.push(actionData)}else{stepScore.stepDataList.push(actionData);for(var i in studentStepScoreList){if(studentStepScoreList[i].robotName==robotName){studentStepScoreList[i].stepScoreList.push(stepScore);break}}}break}}}else{if(step==8){for(var j in studentStepScoreList){if(studentStepScoreList[j].robotName==robotName){var stepScoreList=studentStepScoreList[j].stepScoreList;var flag=false;var index=0;for(var k in stepScoreList){if(stepScoreList[k].step==8&&stepScoreList[k].loopNum==loopNum){index=k;flag=true;break}}if(flag==true){stepScoreList[index].stepDataList.push(actionData)}else{stepScore.stepDataList.push(actionData);for(var i in studentStepScoreList){if(studentStepScoreList[i].robotName==robotName){studentStepScoreList[i].stepScoreList.push(stepScore);break}}}break}}}}}}var tempStepScoreList=[];function searchStudentScore(robotName){var stepScoreList=[];for(var i in studentStepScoreList){if(studentStepScoreList[i].robotName==robotName){stepScoreList=studentStepScoreList[i].stepScoreList;break}}var firstFive=_.findIndex(stepScoreList,function(chr){return chr.step=="5"});if(firstFive==-1){firstFive=stepScoreList.length+1}var lastEight=_.findLastIndex(stepScoreList,function(chr){return chr.step=="8"});if(lastEight==-1){removePlaceScore(robotName);removePressPoseScore(robotName);removeCareScore(robotName);removePressCcScore(robotName);loopStepFlag=false;return false}var breathFirst=true;var lineStepScoreList=_.take(stepScoreList,firstFive);for(var j in lineStepScoreList){var currentStep=lineStepScoreList[j].step;currentStep=parseInt(currentStep);if(currentStep==8){breathFirst=false}var stepScores=lineStepScoreList[j].stepDataList;var score=stepScores[stepScores.length-1];if(j==0){if(currentStep==1){giveScoreByStep(robotName,1,qcprStand.SAFE_STEP_SCORE);giveScoreByAbility(robotName,1,score)}}else{if(currentStep==1||currentStep==2||currentStep==3||currentStep==4){var lastStep=lineStepScoreList[j-1].step;lastStep=parseInt(lastStep);if(currentStep-lastStep==1||currentStep-lastStep==0){switch(currentStep){case 1:giveScoreByStep(robotName,1,qcprStand.SAFE_STEP_SCORE);giveScoreByAbility(robotName,1,score);
break;case 2:giveScoreByStep(robotName,2,qcprStand.KNOW_STEP_SCORE);giveScoreByAbility(robotName,2,score);break;case 3:giveScoreByStep(robotName,3,qcprStand.PULSE_STEP_SCORE);giveScoreByAbility(robotName,3,score);break;case 4:giveScoreByStep(robotName,4,qcprStand.HELP_STEP_SCORE);giveScoreByAbility(robotName,4,score);break}}}}}var loopIsTrue=true;var pressIsTrue=[0,0,0,0,0];var toothIsTrue=[0,0,0,0,0];var airwayIsTrue=[0,0,0,0,0];var breathIsTrue=[0,0,0,0,0];var allLoopStepScoreList=stepScoreList.slice(firstFive,lastEight+1);tempStepScoreList=stepScoreList.slice(firstFive,lastEight+1);if(allLoopStepScoreList.length==0){return false}for(var j in allLoopStepScoreList){var step=allLoopStepScoreList[j].step;if(step!=5&&step!=6&&step!=7&&step!=8){giveScoreByStep(robotName,step,0);giveScoreByAbility(robotName,step,0)}}if(breathFirst==false){pressIsTrue=[1,1,1,1,1];toothIsTrue=[1,1,1,1,1];airwayIsTrue=[1,1,1,1,1];breathIsTrue=[1,1,1,1,1];return false}else{for(var a=0;a<5;a++){var oneFive=_.findIndex(allLoopStepScoreList,function(chr){return chr.step=="5"});if(oneFive==-1){oneFive=allLoopStepScoreList.length+1}var oneEight=_.findIndex(allLoopStepScoreList,function(chr){return chr.step=="8"});if(oneEight==-1){oneEight=allLoopStepScoreList.length+1}var loopStepScoreList=allLoopStepScoreList.slice(oneFive,oneEight+1);var loopStepList=[];for(var k in loopStepScoreList){var step=loopStepScoreList[k].step;if(step==5||step==6||step==7||step==8){loopStepList.push(step)}}if(loopStepList.toString()==[5,6,7,8].toString()){pressIsTrue[a]=2;toothIsTrue[a]=2;airwayIsTrue[a]=2;breathIsTrue[a]=2}else{if(loopStepList.toString()==[5,6,8].toString()){pressIsTrue[a]=2;toothIsTrue[a]=2;airwayIsTrue[a]=1;breathIsTrue[a]=1;loopIsTrue=false}else{if((loopStepList.toString()==[5,7,8].toString())||(loopStepList.toString()==[5,8].toString())){pressIsTrue[a]=2;toothIsTrue[a]=1;airwayIsTrue[a]=1;breathIsTrue[a]=1;loopIsTrue=false}}}if(a==4){giveScoreByStep(robotName,5,qcprStand.PRESS_STEP_SCORE);if(loopIsTrue==true){giveScoreByStep(robotName,6,qcprStand.TOOTH_STEP_SCORE);giveScoreByStep(robotName,7,qcprStand.AIRWAY_STEP_SCORE);giveScoreByStep(robotName,8,qcprStand.BREATH_STEP_SCORE)}if(!(toothIsTrue[0]==1||toothIsTrue[1]==1||toothIsTrue[2]==1||toothIsTrue[3]==1||toothIsTrue[4]==1)){giveScoreByStep(robotName,6,qcprStand.TOOTH_STEP_SCORE);giveScoreByAbility(robotName,6,qcprStand.TOOTH_SCORE)}if(!(airwayIsTrue[0]==1||airwayIsTrue[1]==1||airwayIsTrue[2]==1||airwayIsTrue[3]==1||airwayIsTrue[4]==1)){giveScoreByStep(robotName,7,qcprStand.AIRWAY_STEP_SCORE);giveScoreByAbility(robotName,7,qcprStand.AIRWAY_SCORE)}}allLoopStepScoreList.splice(oneFive,oneEight-oneFive+1)}}var loopnum=checkPressLoopNum(robotName);if(loopnum!=5){giveScoreByStep(robotName,9,0);giveScoreByAbility(robotName,9,0)}else{var theOneFive=_.findIndex(stepScoreList,function(chr){return chr.step=="5"});var theFinalEight=_.findLastIndex(stepScoreList,function(chr){return chr.step=="8"});stepScoreList.splice(theOneFive,theFinalEight-theOneFive+1);var lastData=stepScoreList[stepScoreList.length-1];if(lastData!=null&&lastData.step==9){var lastScore=lastData.stepDataList;giveScoreByStep(robotName,9,qcprStand.ASSESS_STEP_SCORE);giveScoreByAbility(robotName,9,lastScore[lastScore.length-1])}else{giveScoreByStep(robotName,9,0);giveScoreByAbility(robotName,9,0)}}pressBreathScore(robotName,tempStepScoreList,breathIsTrue)}function checkLivingState(robotName){var operationList=[];var pressDataList=[];var breathDataList=[];for(var i in studentStepScoreList){if(studentStepScoreList[i].robotName==robotName){operationList=studentStepScoreList[i].stepScoreList;break}}for(var i in operationList){if(operationList[i].step==5){pressDataList=pressDataList.concat(operationList[i].stepDataList)}else{if(operationList[i].step==8){breathDataList=breathDataList.concat(operationList[i].stepDataList)}}}var pressTrueNum=0;var pressTrueRate=0;for(var j in pressDataList){var undelivered=pressDataList[j].undelivered;var depth=pressDataList[j].depth;var middle=pressDataList[j].middle;var freq=pressDataList[j].freq;if(undelivered==0&&depth>=qcprStand.PRESS_DEEP_LOW&&depth<=qcprStand.PRESS_DEEP_HEIGHT&&middle==1&&((freq>=qcprStand.PRESS_RATE_LOW&&freq<=qcprStand.PRESS_RATE_HEIGHT)||(freq==0))){pressTrueNum++}}if(pressDataList.length<=150){pressTrueRate=Math.round(pressTrueNum/150*100)}else{pressTrueRate=Math.round(pressTrueNum/pressDataList.length*100)}var breathTrueNum=0;var breathTrueRate=0;for(var j in breathDataList){var fast=breathDataList[j].fast;var breath=breathDataList[j].breath;if(fast==0&&breath>=qcprStand.BREATH_VOLUME_LOW&&breath<=qcprStand.BREATH_VOLUME_HEIGHT){breathTrueNum++}}if(breathDataList.length<=10){breathTrueRate=Math.round(breathTrueNum/10*100)}else{breathTrueRate=Math.round(breathTrueNum/breathDataList.length*100)}if(pressTrueRate>=qcprStand.PRESS_TRUE_RATE_LOW&&breathTrueRate>=qcprStand.BREATH_TRUE_RATE_LOW){return 1}else{return 0}}function checkPressData(stepDataList){var flag=true;if(stepDataList.length!=30){return false
}for(var i in stepDataList){var pressData=stepDataList[i];var undelivered=pressData.undelivered;if(undelivered==1){flag=false;break}var middle=pressData.middle;if(middle==0){flag=false;break}var left=pressData.left;var right=pressData.right;var up=pressData.up;var down=pressData.down;var depth=pressData.depth;if(depth<qcprStand.PRESS_DEEP_LOW||depth>qcprStand.PRESS_DEEP_HEIGHT){flag=false;break}var freq=pressData.freq;if(i!=0){if(freq<qcprStand.PRESS_RATE_LOW||freq>qcprStand.PRESS_RATE_HEIGHT){flag=false;break}}}return flag}function checkBreathData(stepDataList){var flag=true;if(stepDataList.length!=2){return false}for(var i in stepDataList){var breathData=stepDataList[i];var fast=breathData.fast;if(fast!=0){flag=false;break}var breath=breathData.breath;if(breath<qcprStand.BREATH_VOLUME_LOW||breath>qcprStand.BREATH_VOLUME_HEIGHT){flag=false;break}}return flag}function pressBreathScore(robotName,loopStepScoreList,breathIsTrue){if(loopStepScoreList.length==0){loopStepFlag=false;return false}var pressLessNum=0;var breathLessNum=0;if(loopStepScoreList[loopStepScoreList.length-1].loopNum<5){var theFinalFive=_.findLastIndex(loopStepScoreList,function(chr){return chr.step=="5"});var theFinalEight=_.findLastIndex(loopStepScoreList,function(chr){return chr.step=="8"});var fiveLoopNum=loopStepScoreList[theFinalFive].loopNum;if(fiveLoopNum<5){pressLessNum+=(5-fiveLoopNum)*30}var eightLoopNum=loopStepScoreList[theFinalEight].loopNum;if(eightLoopNum<5){breathLessNum+=(5-eightLoopNum)*2}}var loopStepScoreListLength=loopStepScoreList.length;for(var i=0;i<loopStepScoreListLength;i++){var step=loopStepScoreList[i].step;var loopNum=loopStepScoreList[i].loopNum;if(loopNum>5){break}if(step==5){var length=loopStepScoreList[i].stepDataList.length;if(length<30){pressLessNum+=30-length}}if(step==8){var length=loopStepScoreList[i].stepDataList.length;if(length<2){breathLessNum+=2-length}}}var pressRealNum=0;var breathLength=0;var breathRealNum=0;var pressBackTrueNum=0;var pressDepthTrueNum=0;var pressTrueNum=0;var pressFreqCount=0;var breathTrueNum=0;var loopStepScoreLength=loopStepScoreList.length;for(var i=0;i<loopStepScoreLength;i++){var step=loopStepScoreList[i].step;var dataList=loopStepScoreList[i].stepDataList;var loopNum=loopStepScoreList[i].loopNum;if(loopNum>5){break}if(step==5){pressRealNum+=dataList.length;for(var j in dataList){var undelivered=dataList[j].undelivered;var depth=dataList[j].depth;var middle=dataList[j].middle;var freq=dataList[j].freq;if(undelivered==0&&depth>=qcprStand.PRESS_DEEP_LOW&&depth<=qcprStand.PRESS_DEEP_HEIGHT&&middle==1&&((freq>=qcprStand.PRESS_RATE_LOW&&freq<=qcprStand.PRESS_RATE_HEIGHT)||(freq==0))){pressTrueNum++}pressFreqCount+=freq;if(undelivered==0){pressBackTrueNum++}if(depth>=qcprStand.PRESS_DEEP_LOW&&depth<=qcprStand.PRESS_DEEP_HEIGHT){pressDepthTrueNum++}}}if(step==8){var breathStatus=breathIsTrue[loopNum-1];if(breathStatus==2){breathRealNum+=dataList.length;for(var j in dataList){var fast=dataList[j].fast;var breath=dataList[j].breath;if(fast==0&&breath>=qcprStand.BREATH_VOLUME_LOW&&breath<=qcprStand.BREATH_VOLUME_HEIGHT){breathTrueNum++}}}else{breathLength+=loopStepScoreList[i].stepDataList.length}}}var livingState=0;var pressTotalNum=pressLessNum+pressRealNum;var breathTotalNum=breathLessNum+breathLength+breathRealNum;var loopNum=checkPressLoopNum(robotName);var pressTrueRate=pressTrueNum/pressTotalNum;var pressBackTrueRate=pressBackTrueNum/pressTotalNum;var pressDepthTrueRate=pressDepthTrueNum/pressTotalNum;var pressFrepRate=0;if(pressRealNum-loopNum!=0){pressFrepRate=pressFreqCount/(pressRealNum-loopNum)}var breathTrueRate=breathTrueNum/breathTotalNum;var pressScore=Math.round(pressTrueRate*qcprStand.PRESS_SCORE);if(pressTrueRate*100<qcprStand.PRESS_TRUE_RATE_LOW){pressScore=0}var breathScore=Math.round(breathTrueRate*qcprStand.BREATH_SCORE);if(breathTrueRate*100<qcprStand.BREATH_TRUE_RATE_LOW){breathScore=0}giveScoreByAbility(robotName,5,pressScore);giveScoreByAbility(robotName,8,breathScore);for(var i in studentTotalScoreList){if(studentTotalScoreList[i].robotName==robotName){studentTotalScoreList[i].pressBackTrueRate=parseInt(pressBackTrueRate*100);studentTotalScoreList[i].pressDeepTrueRate=parseInt(pressDepthTrueRate*100);studentTotalScoreList[i].pressSpeedTrueRate=parseInt(pressFrepRate);studentTotalScoreList[i].pressTrueRate=parseInt(pressTrueRate*100);studentTotalScoreList[i].breathTrueRate=parseInt(breathTrueRate*100);break}}}function giveScoreByStep(robotName,stepIndex,stepScore){for(var k in studentTotalScoreList){if(studentTotalScoreList[k].robotName==robotName){switch(stepIndex){case 1:studentTotalScoreList[k].safeStepScore=stepScore;break;case 2:studentTotalScoreList[k].knowStepScore=stepScore;break;case 3:studentTotalScoreList[k].pulseStepScore=stepScore;break;case 4:studentTotalScoreList[k].helpStepScore=stepScore;break;case 5:studentTotalScoreList[k].pressStepScore=stepScore;break;case 6:studentTotalScoreList[k].toothStepScore=stepScore;break;case 7:studentTotalScoreList[k].airwayStepScore=stepScore;
break;case 8:studentTotalScoreList[k].breathStepScore=stepScore;break;case 9:studentTotalScoreList[k].assessStepScore=stepScore;break}break}}}function giveScoreByAbility(robotName,stepIndex,score){for(var k in studentTotalScoreList){if(studentTotalScoreList[k].robotName==robotName){switch(stepIndex){case 1:studentTotalScoreList[k].safeScore=score;break;case 2:studentTotalScoreList[k].knowScore=score;break;case 3:studentTotalScoreList[k].pulseScore=score;break;case 4:studentTotalScoreList[k].helpScore=score;break;case 5:studentTotalScoreList[k].pressScore=score;break;case 6:studentTotalScoreList[k].toothScore=score;break;case 7:studentTotalScoreList[k].airwayScore=score;break;case 8:studentTotalScoreList[k].breathScore=score;break;case 9:studentTotalScoreList[k].assessScore=score;break}break}}}function removePlaceScore(robotName){for(var i in studentTotalScoreList){if(studentTotalScoreList[i].robotName==robotName){studentTotalScoreList[i].placeScore=0;$("#btn_place_"+robotName).removeClass("btn btn-primary").addClass("btn btn-default").attr("disabled","disabled");break}}}function removePressPoseScore(robotName){for(var i in studentTotalScoreList){if(studentTotalScoreList[i].robotName==robotName){studentTotalScoreList[i].pressPoseScore=0;$("#btn_press_pose"+robotName).removeClass("btn btn-primary").addClass("btn btn-default").attr("disabled","disabled");break}}}function removeCareScore(robotName){for(var i in studentTotalScoreList){if(studentTotalScoreList[i].robotName==robotName){studentTotalScoreList[i].careScore=0;$("#btn_care_"+robotName).removeClass("btn btn-primary").addClass("btn btn-default").attr("disabled","disabled");break}}}function removePressCcScore(robotName){for(var i in studentTotalScoreList){if(studentTotalScoreList[i].robotName==robotName){studentTotalScoreList[i].ccScore=0;break}}}function getTimer(robotName,times){var time=times;return function(){var second=time%60;if(second<10){second="0"+second}var minute=parseInt(time/60);if(minute<10){minute="0"+minute}var hour=parseInt(time/3600);if(hour<10){hour="0"+hour}$("#totalTime_"+robotName).html(" "+hour+":"+minute+":"+second);time=time+1}}function finishTime(robotName){for(var i in timerList){if(timerList[i].robotName==robotName){clearInterval(timerList[i].time);break}}}function drawProcess(ploder,process){$(ploder).each(function(){var canvas=this;var context=canvas.getContext("2d");var endValue=0;var dw=canvas.width;var dh=canvas.height;var x=dw/2;var y=dw/2;var radius=x-(dw*15/100);var lineWidth=dw/16;var fontSize=dw*0.18;var timer=setInterval(function(){endValue=endValue+1>process?process:endValue+1;context.clearRect(0,0,dw,dh);context.imageSmoothingEnabled=true;context.beginPath();context.arc(x,y,radius,0,Math.PI*2,true);context.lineWidth=lineWidth;context.strokeStyle="#ddd";context.stroke();context.beginPath();if(endValue==100){context.arc(x,y,radius,Math.PI*1.5,Math.PI*(1.5+2*(endValue+1)/100))}else{context.arc(x,y,radius,Math.PI*1.5,Math.PI*(1.5+2*endValue/100))}context.lineWidth=lineWidth;if(endValue<=30){context.strokeStyle="#fcc100"}else{if(endValue>30&&endValue<60){context.strokeStyle="#a88add"}else{if(endValue>=60){context.strokeStyle="#0cc2aa"}}}context.stroke();context.beginPath();context.font="bold "+fontSize+"pt Arial";if(endValue<=30){context.fillStyle="#fcc100"}else{if(endValue>30&&endValue<60){context.fillStyle="#a88add"}else{if(endValue>=60){context.fillStyle="#0cc2aa"}}}context.textAlign="center";context.textBaseline="middle";context.fillText(endValue+"%",x,y);if(endValue===process||process==0){clearInterval(timer)}},20)})}function drawHalfProcess(ploder,process){$(ploder).each(function(){var canvas=this;var context=canvas.getContext("2d");var endValue=0;var dw=canvas.width;var dh=canvas.height;var x=dw/2;var y=dw/2;var radius=x-(dw*15/100);var lineWidth=dw/16;var fontSize=dw*0.18;var maxValue=150;var timer=setInterval(function(){endValue=endValue+1>process?process:endValue+1;context.clearRect(0,0,dw,dh);context.imageSmoothingEnabled=true;context.beginPath();context.arc(x,y,radius,0,Math.PI,true);context.lineWidth=lineWidth;context.strokeStyle="#ddd";context.stroke();context.closePath();context.beginPath();context.arc(x,y,radius,Math.PI,((Math.PI*(endValue*100/maxValue))/100)+Math.PI);context.lineWidth=lineWidth;if(endValue<=qcprStand.PRESS_RATE_LOW){context.strokeStyle="#fcc100"}else{if(endValue>qcprStand.PRESS_RATE_LOW&&endValue<qcprStand.PRESS_RATE_HEIGHT){context.strokeStyle="#a88add"}else{if(endValue>=qcprStand.PRESS_RATE_HEIGHT){context.strokeStyle="#0cc2aa"}}}context.stroke();context.closePath();context.font="bold "+fontSize+"pt Arial";if(endValue<=qcprStand.PRESS_RATE_LOW){context.fillStyle="#fcc100"}else{if(endValue>qcprStand.PRESS_RATE_LOW&&endValue<qcprStand.PRESS_RATE_HEIGHT){context.fillStyle="#a88add"}else{if(endValue>=qcprStand.PRESS_RATE_HEIGHT){context.fillStyle="#0cc2aa"}}}context.textAlign="center";context.textBaseline="middle";context.fillText(endValue,x,y);if(endValue===process||process==0){clearInterval(timer)
}},10)})};